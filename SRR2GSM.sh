#!/bin/sh
#
# SRR2GSM.sh 
#
# run this in the directory containing the SRR files
# the GSM files will end up in the same directory
# Will rename concatenate multiple SRR files belonging to one GSM sample.
# If there is 1 SRR file, make a GSM-named symlink to the SRR file.
# If there are 2+ SRR files, make a new GSM-named file from the concatenation of the SRR files.

alias sbcompute4.4='sbatch --partition=bch-compute --time=04:00:00 --job-name="wtp-compute" --output=output_%j.txt --nodes=1 --ntasks=4 --mem=20G'

# edit the below list: GSM_SRR1-SRR2 or GSM_SRR1

list=(
GSM2944725_SRR6503172
GSM2944726_SRR6503173
GSM2944727_SRR6503174
GSM2944728_SRR6503175
GSM2944729_SRR6503176
GSM2944730_SRR6503177
GSM2944731_SRR6503178
GSM2711002_SRR5839514-SRR5839513
GSM2711003_SRR5839516-SRR5839515
GSM4278011_SRR10919423
GSM4278014_SRR10919426
GSM4212916_SRR10620389
GSM4212917_SRR10620390
GSM4212918_SRR10620391
GSM4212919_SRR10620392
GSM4212920_SRR10620393
GSM4212921_SRR10620394
GSM4212922_SRR10620395
GSM4212923_SRR10620396
GSM4212924_SRR10620397
GSM4212925_SRR10620398
GSM4212926_SRR10620399
GSM4212927_SRR10620400
GSM4146599_SRR10382543
GSM4146600_SRR10382544
GSM4146601_SRR10382545
GSM3637960_SRR8655526
GSM3637961_SRR8655527
GSM3637962_SRR8655528
GSM3637963_SRR8655529
GSM3637964_SRR8655530
GSM3637965_SRR8655531
GSM3637966_SRR8655532
GSM3637967_SRR8655533
GSM3637968_SRR8655534
GSM3637969_SRR8655535
GSM1565286_SRR1709263
GSM1565287_SRR1709264
GSM1565288_SRR1709265
GSM1565289_SRR1709266
GSM1565290_SRR1709267
GSM1565291_SRR1709268
GSM1565292_SRR1709269
GSM1565293_SRR1709270
GSM1565294_SRR1709271
GSM3386328_SRR7824146-SRR7824145
GSM3386329_SRR7824147-SRR7824148
GSM3386330_SRR7824150-SRR7824149
GSM3386331_SRR7824152-SRR7824151
GSM3386336_SRR7824161
GSM3386337_SRR7824162
GSM3386338_SRR7824163
GSM3386339_SRR7824164
GSM3386340_SRR7824165
GSM3386341_SRR7824166
GSM3386346_SRR7824171
GSM3173910_SRR7255031
GSM3173912_SRR7255033
GSM3003981_SRR6726383-SRR6726384
GSM3003982_SRR6726385        
GSM3003983_SRR6726386
GSM3003984_SRR6726387
GSM3003985_SRR6726388
GSM3003986_SRR6726389
GSM2538390_SRR5349559
GSM2538391_SRR5349560
GSM2461467_SRR5183604
GSM2461468_SRR5183605
GSM2461469_SRR5183606
GSM2461470_SRR5183607
GSM2461471_SRR5183608
GSM2461472_SRR5183609
GSM2461475_SRR5183612
GSM2671064_SRR5688352
GSM2671065_SRR5688353
GSM2671068_SRR5688356
GSM2671069_SRR5688357
GSM2671072_SRR5688360
GSM1891954_SRR2503203
GSM1891955_SRR2503204
GSM1891956_SRR2503205
GSM1891957_SRR2503206
GSM1902461_SRR2566302
GSM1902462_SRR2566303
GSM1902475_SRR2566316
GSM1902476_SRR2566317
GSM1902477_SRR2566318
GSM1902478_SRR2566319
GSM1902482_SRR2566323
GSM2058466_SRR4272561
GSM2058467_SRR4272560
GSM2424113_SRR5112226
GSM2308548_SRR4235689
GSM2308549_SRR4235690
GSM2308485_SRR4235615-SRR4235614-SRR4235613
GSM2308486_SRR4235616-SRR4235617
GSM2308497_SRR4235629-SRR4235628        
GSM2308498_SRR4235631-SRR4235630
GSM2308608_SRR4235758
GSM2308609_SRR4235759
GSM2308606_SRR4235754
GSM2308607_SRR4235755
GSM2308518_SRR4235654
GSM2308519_SRR4235655
GSM2308570_SRR4235703
GSM2308571_SRR4235704
GSM2192515_SRR3653348-SRR3653347
GSM2192516_SRR3653350-SRR3653349
GSM2192035_SRR3652570-SRR3652572-SRR3652571
GSM2192036_SRR3652575-SRR3652574-SRR3652573
GSM2192401_SRR3653203
GSM2192221_SRR3652967
GSM2192222_SRR3652968
GSM2191993_SRR3652501
GSM2191994_SRR3652502
GSM2192231_SRR3652965
GSM2192232_SRR3652966
GSM2192402_SRR3653204
GSM2191518_SRR3651841
GSM2191519_SRR3651842
GSM2192335_SRR3653103
GSM2192336_SRR3653105-SRR3653104
GSM2192145_SRR3652868
GSM2192146_SRR3652869
GSM2192525_SRR3653361
GSM2192526_SRR3653362
GSM2192077_SRR3652651
GSM2192078_SRR3652652-SRR3652653
GSM2192163_SRR3652871
GSM2192164_SRR3652872
GSM2192107_SRR3652708
GSM2192108_SRR3652709
GSM2192085_SRR3652662
GSM2192086_SRR3652663
GSM2191068_SRR3651324-SRR3651325
GSM2191069_SRR3651326-SRR3651327-SRR3651328
GSM2192061_SRR3652608-SRR3652607
GSM2192062_SRR3652609
GSM2192333_SRR3653110
GSM2192334_SRR3653111
GSM2192079_SRR3652654
GSM2192080_SRR3652655
GSM2192509_SRR3653341
GSM2192510_SRR3653342
GSM2191707_SRR3652069-SRR3652070
GSM2191708_SRR3652071-SRR3652072
GSM2192345_SRR3653128
GSM2192271_SRR3653018-SRR3653017
GSM2192272_SRR3653020-SRR3653019
GSM2192219_SRR3652953
GSM2192220_SRR3652954
GSM2192139_SRR3652779
GSM2192140_SRR3652780
GSM2192346_SRR3653129
GSM2423567_SRR5111671
GSM2423568_SRR5111672
GSM2192125_SRR3652753
GSM2192126_SRR3652754
GSM2192285_SRR3653032-SRR3653031
GSM2192286_SRR3653033
GSM2192391_SRR3653189
GSM2192392_SRR3653190
GSM2192519_SRR3653356-SRR3653355
GSM2192520_SRR3653358-SRR3653357
GSM2423474_SRR5111568
GSM2423029_SRR5111114
GSM2423962_SRR5112068
GSM2423963_SRR5112069
GSM1397521_SRR1297211
GSM1397522_SRR1297212
GSM1397523_SRR1297213
GSM1500749_SRR1571973
GSM1500750_SRR1571974
GSM1500751_SRR1571975
GSM1264370_SRR1029874
GSM1264371_SRR1029875
GSM1264372_SRR1029876
GSM1264373_SRR1029877
GSM1264374_SRR1029878
GSM1264375_SRR1029879
GSM1264376_SRR1029880
GSM1264377_SRR1029881
GSM1264378_SRR1029882
GSM1264379_SRR1029883
GSM1264380_SRR1029884
GSM1264381_SRR1029885
GSM1264382_SRR1029886
GSM1264383_SRR1029887
GSM1264384_SRR1029888
GSM1264385_SRR1029889
GSM1225096_SRR970169
GSM1225098_SRR970171
GSM1225099_SRR970172
GSM1225101_SRR970174
GSM1225102_SRR970175
GSM1133697_SRR846960
GSM1133698_SRR846961
GSM1133701_SRR846964
GSM1184306_SRR931604
GSM1184309_SRR931607
GSM1131317_SRR836133
GSM1131318_SRR836134
GSM722692_SRR207017-SRR207016
GSM722693_SRR207018-SRR207019
GSM722694_SRR207020-SRR207021
GSM722695_SRR207023-SRR207022
GSM722696_SRR207024-SRR207025
GSM722697_SRR207026-SRR207027
GSM918723_SRR489669-SRR489670
GSM918747_SRR489718-SRR489717
GSM918756_SRR489735-SRR489736
GSM918755_SRR489734-SRR489733
GSM742286_SRR285188
GSM742287_SRR285189
GSM742288_SRR285190
GSM734426_SRR223492
GSM734427_SRR223493
GSM769017_SRR317240-SRR317239
GSM769025_SRR317256-SRR317255
GSM769032_SRR317269-SRR317270
GSM1000093_SRR566828-SRR566827
GSM1000129_SRR566900-SRR566899
GSM1000130_SRR566902-SRR566901
GSM1000131_SRR566904-SRR566903
GSM1000135_SRR566912-SRR566911
GSM1000136_SRR566914-SRR566913
GSM1000137_SRR566916-SRR566915
GSM1000149_SRR566940-SRR566939
GSM1000208_SRR566972-SRR566971
GSM1260008_SRR1025220
GSM1260009_SRR1025221
GSM1260010_SRR1025222
GSM1260011_SRR1025223
GSM1260012_SRR1025224
GSM1260013_SRR1025225
GSM1260014_SRR1025226
GSM1260015_SRR1025227
GSM1260016_SRR1025228
GSM1260017_SRR1025229
GSM1260018_SRR1025230
GSM1260019_SRR1025231
GSM1260020_SRR1025232
GSM1260021_SRR1025233
GSM1260024_SRR1025236
GSM1260025_SRR1025237
GSM1260026_SRR1025238
GSM1260027_SRR1025239
GSM1260028_SRR1025240
GSM1260029_SRR1025241
GSM1260030_SRR1025242
GSM1260031_SRR1025243
GSM1260032_SRR1025244
GSM1260033_SRR1025245
GSM1260034_SRR1025246
GSM1260035_SRR1025247
GSM1260039_SRR1025251
GSM1260040_SRR1025252
GSM1478326_SRR1550903
GSM1478327_SRR1550904
GSM1478328_SRR1550905
GSM1478329_SRR1550906
GSM1478330_SRR1550907
GSM1478331_SRR1550908
GSM1478334_SRR1550911
GSM1478335_SRR1550912
GSM3518644_SRR8335322
GSM3518645_SRR8335323
GSM3518646_SRR8335324
GSM3518647_SRR11798798
GSM3518648_SRR8335326
GSM3518649_SRR8335327
GSM3518650_SRR8335328
GSM3518651_SRR8335329
GSM3518652_SRR8335330
GSM3518653_SRR8335331
GSM3518654_SRR8335332
GSM3518655_SRR8335333
GSM3518656_SRR8335334
GSM3518657_SRR8335335
GSM3518658_SRR8335336
GSM3518659_SRR8335337
GSM3518660_SRR8335338
GSM3518661_SRR8335339
GSM3518662_SRR8335340
GSM3518663_SRR8335341
GSM3518664_SRR8335342
GSM3518665_SRR8335343
GSM3518666_SRR8335344
GSM3518667_SRR8335345
GSM3518668_SRR8335346
GSM3518669_SRR8335347
GSM3518670_SRR8335348
GSM3518671_SRR8335349
GSM3518672_SRR8335350
GSM3518673_SRR8335351
GSM3518674_SRR8335352
GSM3518675_SRR8335353
GSM3518676_SRR8335354
GSM3518677_SRR8335355
GSM3518678_SRR8335356
GSM3518679_SRR8335357
GSM3518680_SRR8335358
GSM3579629_SRR8487091
GSM3579630_SRR8487092
GSM2191330_SRR3651589
GSM2191331_SRR3651590
GSM2191196_SRR3651423-SRR3651424
GSM2191197_SRR3651425
GSM2191615_SRR3651960
GSM2191616_SRR3651961
GSM2191965_SRR3652456
GSM2191966_SRR3652457
GSM2308485_SRR4235615-SRR4235614-SRR4235613
GSM2192515_SRR3653348-SRR3653347
GSM2192516_SRR3653350-SRR3653349
GSM2191194_SRR3651421
GSM2191195_SRR3651422
GSM2191639_SRR3651994-SRR3651993
GSM2191640_SRR3651995
GSM2191609_SRR3651948
GSM2191610_SRR3651949
GSM2191737_SRR3652105-SRR3652104
GSM2191738_SRR3652107-SRR3652106
GSM2192272_SRR3653019-SRR3653020
GSM2308497_SRR4235629-SRR4235628
GSM2308498_SRR4235631-SRR4235630
GSM2192035_SRR3652570-SRR3652571-SRR3652572
GSM2192036_SRR3652573-SRR3652574-SRR3652575
GSM2192336_SRR3653104-SRR3653105
GSM2191358_SRR3651634-SRR3651635
GSM2191359_SRR3651637-SRR3651636
GSM2191941_SRR3652413-SRR3652414-SRR3652415
GSM2191942_SRR3652416-SRR3652417
GSM2191791_SRR3652186
GSM2191792_SRR3652187
GSM2191352_SRR3651630-SRR3651631
GSM2191353_SRR3651632-SRR3651633
GSM2191741_SRR3652113
GSM2191742_SRR3652114
GSM2191070_SRR3651329
GSM2191071_SRR3651330-SRR3651331-SRR3651332
GSM2191562_SRR3651886
GSM2191563_SRR3651887
GSM2191388_SRR3651684-SRR3651685
GSM2191389_SRR3651687-SRR3651686
GSM2191825_SRR3652242
GSM2191826_SRR3652243
GSM2191673_SRR3652032
GSM2191674_SRR3652033
GSM2191881_SRR3652294
GSM2191882_SRR3652295
GSM2191637_SRR3651985
GSM2191638_SRR3651986
GSM2191629_SRR3651977
GSM2191630_SRR3651978
GSM2308607_SRX2157018
GSM2191841_SRR3652246
GSM2191842_SRR3652247
GSM2191012_SRR3651307
GSM2191013_SRR3651308
GSM2191188_SRR3651419
GSM2191189_SRR3651420
GSM2191052_SRR3651293
GSM2191053_SRR3651294
GSM2191583_SRR3651917
GSM2191584_SRR3651918
GSM2191627_SRR3651969
GSM2191628_SRR3651970
GSM2191865_SRR3652279
GSM2191866_SRR3652280
GSM2191779_SRR3652173-SRR3652172
GSM2191780_SRR3652174
GSM2191937_SRR3652407
GSM2191938_SRR3652408
GSM2191149_SRR3651385
GSM2191151_SRR3651386
GSM2190928_SRR3651163-SRR3651164
GSM2190929_SRR3651167-SRR3651166-SRR3651165
GSM2191060_SRR3651354
GSM2191061_SRR3651355
GSM2191192_SRR3651436
GSM2191193_SRR3651437
GSM2192519_SRR3653356-SRR3653355
GSM2192520_SRR3653357-SRR3653357
GSM2308571_SRX2156974
GSM2192078_SRR3652652-SRR3652653
GSM2191707_SRR3652070-SRR3652069
GSM2191552_SRR3651884
GSM2191553_SRR3651885
GSM3847605_SRR9190134
GSM3847606_SRR9190135
GSM4395700_SRR11256141
GSM4395701_SRR11256142
GSM4395702_SRR11256143
GSM4395703_SRR11256144
GSM4395704_SRR11256145
GSM4395705_SRR11256146
GSM2982729_SRR6676832
GSM2982733_SRR6676836
GSM3383875_SRR7818888
GSM3383876_SRR7818889
GSM3383879_SRR7818892
GSM3383880_SRR7818893
GSM3386328_SRR7824145-SRR7824146
GSM2525591_SRR5318031
GSM2525592_SRR5318032
GSM2525593_SRR5318033
GSM2525594_SRR5318034
GSM2525595_SRR5318035
GSM2525596_SRR5318036
GSM2525597_SRR5318037
GSM2525598_SRR5318038
GSM2525599_SRR5318039
GSM2346470_SRR4424233
GSM2346471_SRR4424234
)

for i in ${list[@]}; do
	GSM1=$(echo $i | cut -f 1 -d "_")_1.fastq.gz	# get the GSM name for read 1
	GSM2=$(echo $i | cut -f 1 -d "_")_2.fastq.gz	# get the GSM name for read 2
	j=$(echo $i | cut -f 2 -d "_")	# get the SRR name or names
	SRRlist1=( $(echo $j | tr "-" " ") ) # replace '-' with ' ', and make the list
	SRRlist2=( $(echo $j | tr "-" " ") )
	for ((k=0;k<${#SRRlist1[@]};k++)); do	# append .fastq.gz onto each SRR name
		SRRlist1[k]="${SRRlist1[k]}_1.fastq.gz" # SRR name for read 1
		SRRlist2[k]="${SRRlist2[k]}_2.fastq.gz" # SRR name for read 2
		done
	echo ${SRRlist1[*]}
	echo ${SRRlist2[*]}	
	echo
	
	length=${#SRRlist1[@]}	# length of SRRlist
	# if one item in the list then make symlink with GSM name
	if [[ length -eq 1 ]]; then
		ln -s ${SRRlist1} ${GSM1}
		if [ -f ${SRRlist2} ]; then		# if read 2 then also make a read 2 GSM file
			ln -s ${SRRlist2} ${GSM2}
		fi
	# otherwise concatenate multiple SRR into one GSM
	else
		sbcompute4.4 --wrap="cat ${SRRlist1[*]} > ${GSM1}"	# send batch job to concatenate the files and store as GSM1 file
		if [ -f ${SRRlist2[0]} ]; then	# if read 2 then also make a read 2 GSM file
				sbcompute4.4 --wrap="cat ${SRRlist2[*]} > ${GSM2}"	# send batch job to concatenate the files and store as GSM1 file
		fi
	fi
done


	
	
	
	