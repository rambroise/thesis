#!/bin/sh
#
# MAC2 peakcalling on TF-binding data
#
alias sbcompute4.24='sbatch --partition=bch-compute --time=24:00:00 --job-name="wtp-compute" --output=output_%j.txt --nodes=1 --ntasks=4 --mem=20G'

arraydata=(
GSM2191196,GSM2192078
GSM2191197,GSM2192077
GSM2191741,GSM2192078
GSM2191742,GSM2192077
GSM2192145,GSM2192078
GSM2192146,GSM2192077
GSM2191194,GSM2192078
GSM2191195,GSM2192077
GSM1902461,GSM1902478
GSM1902462,GSM1902478
GSM722693,GSM722697
GSM769025,GSM769032
GSM722694,GSM722697
GSM769017,GSM769032
GSM2461471,GSM2461475
GSM2461472,GSM2461475
GSM1260026,GSM1260028
GSM1260027,GSM1260028
GSM1260010,GSM1260012
GSM1260011,GSM1260012
GSM3518644,GSM3518646
GSM3518645,GSM3518646
GSM3518665,GSM3518667
GSM3518666,GSM3518667
GSM3518647,GSM3518649
GSM3518648,GSM3518649
GSM3518650,GSM3518652
GSM3518651,GSM3518652
GSM3518668,GSM3518670
GSM3518669,GSM3518670
GSM3518653,GSM3518654
GSM3518655,GSM3518656
GSM2944729,GSM2944731
GSM2944730,GSM2944731
GSM3518657,GSM3518658
GSM3518659,GSM3518660
GSM3518674,GSM3518676
GSM3518675,GSM3518676
GSM3518661,GSM3518662
GSM3518663,GSM3518664
GSM3518677,GSM3518678
GSM3518679,GSM3518680
GSM2346444,GSM2346443
GSM2346445,GSM2346443
GSM722695,GSM722697
GSM918747,GSM918755
)



for i in ${arraydata[@]}; do 
	chip=$(echo $i | cut -d ',' -f 1) # chip
	input=$(echo $i | cut -d ',' -f 2) # input
	sbcompute4.24 --wrap="macs2 callpeak -t ${chip}_rmchrM.sorted.nodup.bam -c ${input}_rmchrM.sorted.nodup.bam -f BAM -g 1.87e9 -n ${chip} -p 1e-3 --call-summits --fix-bimodal --extsize 200 --outdir macs2_peaks >macs2_peaks/${chip}_macs2.log; sort -k8,8nr macs2_peaks/${chip}_peaks.narrowPeak > macs2_peaks/${chip}_peaks_sorted.narrowPeak"
	done
